- name: 🧪 Ejecutar prueba de HTML
  id: tidy
  shell: bash
  run: |
    # Busca todos los archivos .html y los pasa uno a uno a tidy
    find . -type f -name "*.html" > html_files.txt

    # Crea o vacía el archivo de errores
    > tidy_errors.txt

    # Procesa cada archivo
    while IFS= read -r file; do
      echo "🔍 Validando: $file"
      tidy -e "$file" 2>> tidy_errors.txt
    done < html_files.txt

    if [[ -s tidy_errors.txt ]]; then
      echo "❌ Hay problemas en el test HTML:"
      cat tidy_errors.txt
      echo "::error title=Hay problemas en el test HTML::Revisa las etiquetas mencionadas."
      exit 1
    else
      echo "✅ Todo OK – sin errores de marcado"
    fi
