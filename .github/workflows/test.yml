name: Validar HTML

on: [push, pull_request]

jobs:
  html-check:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Clonar repositorio
        uses: actions/checkout@v3

      - name: üì¶ Instalar HTML Tidy
        run: |
          sudo apt-get update -qq
          sudo apt-get install -yq tidy

      - name: üß™ Validar archivos HTML en la ra√≠z
        shell: bash
        run: |
          > tidy_output.txt
          > tidy_errors.txt

          for file in *.html; do
            echo "üîç Validando: $file"
            tidy -e "$file" 2>> tidy_output.txt
          done

          # Filtra solo las l√≠neas que contienen errores reales
          grep -i "error:" tidy_output.txt > tidy_errors.txt || true

          if [[ -s tidy_errors.txt ]]; then
            echo -e "\n‚ùå Hay problemas en el test HTML:\n"
            cat tidy_errors.txt
            echo "::error title=Errores de HTML detectados::Corrige las etiquetas se√±aladas antes de hacer merge."
            exit 1
          else
            echo -e "\n‚úÖ Todo OK ‚Äì sin errores de marcado"
          fi

