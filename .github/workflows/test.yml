name: Validar HTML

on: [push, pull_request]

jobs:
  html-check:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Clonar repositorio
        uses: actions/checkout@v3

      # Instalamos tidy en modo silencioso (-qq para update, -yq para install)
      - name: üì¶ Instalar HTML‚ÄØTidy
        run: |
          sudo apt-get update -qq
          sudo apt-get install -yq tidy

      # Ejecutamos tidy y bloqueamos si hay errores
      - name: üß™ Ejecutar prueba de HTML
        id: tidy
        shell: bash
        run: |
          # Ejecuta tidy en modo 'errores' (-e) sobre todos los .html
          # Redirige stderr a un archivo para poder inspeccionarlo
          tidy -e **/*.html 2> tidy_errors.txt

          if [[ -s tidy_errors.txt ]]; then
            echo "‚ùå Hay problemas en el test HTML:"
            cat tidy_errors.txt
            # Mostramos una anotaci√≥n para que se vea arriba del log del job
            echo "::error title=Hay problemas en el test HTML,file=tidy_errors.txt::Revisa las etiquetas mencionadas."
            exit 1    # ‚Üê BLOQUEA el PR hasta que se corrija
          else
            echo "‚úÖ Todo OK ‚Äì‚ÄØsin errores de marcado"
          fi
